<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>City Builder 2</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #d0e7ff; /* Light blue */
    margin: 0; padding: 20px;
    color: #222;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  /* Containers */
  #homeScreen, #gameScreen, #howToPlayScreen {
    max-width: 900px;
    margin: 0 auto;
    background: #fff;
    border-radius: 12px;
    padding: 30px 40px 40px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    text-align: center;
  }
  #gameScreen {
    display: none;
  }
  /* Grid */
  #grid {
    display: grid;
    grid-template-columns: repeat(16, 42px);
    grid-template-rows: repeat(16, 42px);
    gap: 3px;
    margin: 25px auto 15px;
    background: #b9d4ff;
    border-radius: 8px;
    border: 2px solid #85b5ff;
    width: max-content;
    user-select:none;
  }
  .tile {
    width: 42px;
    height: 42px;
    background: #f9fbff;
    border-radius: 6px;
    border: 1.5px solid #a0c1ff;
    font-size: 28px;
    line-height: 42px;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  .tile:hover, .tile:focus {
    background-color: #d2e4ff;
    outline: none;
  }
  /* Top bar */
  #topBar {
    margin-bottom: 15px;
    font-size: 20px;
    font-weight: 600;
    color: #0f2c60;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
  }
  #topBar span {
    margin: 5px 15px 5px 0;
  }
  #backToHomeBtn {
    background-color: #558cff;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    user-select:none;
    transition: background-color 0.2s ease;
  }
  #backToHomeBtn:hover, #backToHomeBtn:focus {
    background-color: #3d6ad9;
    outline: none;
  }
  /* Controls */
  #controls {
    margin-bottom: 20px;
  }
  button, select {
    padding: 12px 20px;
    margin: 5px 10px 10px 0;
    font-size: 18px;
    cursor: pointer;
    border-radius: 8px;
    border: 1.5px solid #7fa9ff;
    background-color: #a8c2ff;
    color: #09357b;
    font-weight: 600;
    user-select:none;
    transition: background-color 0.2s ease, border-color 0.2s ease;
  }
  button:active, button:hover, button:focus {
    background-color: #5d8bff;
    border-color: #3d6ad9;
    color: white;
    outline: none;
  }
  select {
    min-width: 210px;
    background-color: #c4dbff;
    border-color: #7fa9ff;
    color: #092c64;
  }
  select:focus {
    outline: none;
    border-color: #3d6ad9;
  }
  /* Popups */
  .popupOverlay {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(15, 44, 96, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }
  .popupContent {
    background: #f9fbff;
    padding: 28px 30px 36px;
    border-radius: 14px;
    width: 350px;
    max-height: 70vh;
    overflow-y: auto;
    box-shadow: 0 6px 20px rgba(15, 44, 96, 0.4);
    text-align: left;
    font-size: 18px;
    color: #0f2c60;
    user-select:none;
  }
  .popupContent h2 {
    margin-top: 0;
    font-size: 24px;
    font-weight: 700;
  }
  .popupContent p {
    white-space: pre-line;
    line-height: 1.4;
  }
  .popupContent ul {
    margin-left: 1.4em;
    padding-left: 0;
  }
  .popupContent li {
    margin-bottom: 8px;
  }
  .popupContent button {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 18px;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background-color: #558cff;
    color: white;
    font-weight: 600;
    user-select:none;
    transition: background-color 0.25s ease;
  }
  .popupContent button:hover, .popupContent button:focus {
    background-color: #3d6ad9;
    outline: none;
  }
  .popupContent button + button {
    margin-left: 12px;
  }
  /* Responsive */
  @media (max-width: 480px) {
    #grid {
      grid-template-columns: repeat(16, 28px);
      grid-template-rows: repeat(16, 28px);
      gap: 1.5px;
    }
    .tile {
      width: 28px;
      height: 28px;
      font-size: 20px;
      line-height: 28px;
    }
    #topBar {
      font-size: 16px;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }
    button, select {
      font-size: 16px;
      padding: 10px 16px;
    }
    .popupContent {
      width: 90vw;
      max-height: 60vh;
      padding: 20px 24px 28px;
      font-size: 16px;
    }
    .popupContent h2 {
      font-size: 20px;
    }
  }
</style>
</head>
<body>

<!-- Home Screen -->
<div id="homeScreen">
  <h1>City Builder 2</h1>
  <button id="startGameBtn">Start Game</button>
  <button id="howToPlayBtn">How to Play</button>
</div>

<!-- How to Play Screen -->
<div id="howToPlayScreen" style="display:none;">
  <h2>How to Play</h2>
  <p>
    Build your city by selecting a building and clicking on the grid to place it.<br/>
    Houses need power plants and water towers within 3 blocks to increase population.<br/>
    Each building generates income every minute, which you collect automatically.<br/>
    Click a building on the grid to upgrade it up to level 3 or delete it for a full refund.<br/>
    Manage your money and population carefully to grow your city.<br/>
  </p>
  <button id="backToHomeFromHowTo">Back</button>
</div>

<!-- Game Screen -->
<div id="gameScreen" role="main">
  <div id="topBar" aria-label="Player stats and navigation">
    <span>üí∞ Money: $<span id="money">0</span></span>
    <span>üë• Population: <span id="population">0</span></span>
    <span>‚è≥ Next Paycheck: <span id="paycheckTimer">60</span>s</span>
    <button id="backToHomeBtn" aria-label="Return to home screen">Home</button>
  </div>

  <div id="controls" role="region" aria-label="Game controls">
    <select id="buildingSelect" aria-label="Select building to construct">
      <option value="">-- Select Building --</option>
    </select>
    <button id="deleteBtn" aria-pressed="false" aria-label="Toggle delete mode">Delete Mode: Off</button>
    <button id="earningsBtn" aria-label="View income sources">View Earnings</button>
  </div>

  <div id="grid" role="grid" aria-label="City building grid"></div>
</div>

<!-- Upgrade/Delete Popup -->
<div id="buildingPopup" class="popupOverlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="popupBuildingName">
  <div class="popupContent">
    <h2 id="popupBuildingName"></h2>
    <p id="popupBuildingInfo"></p>
    <button id="upgradeBuildingBtn">Upgrade Building</button>
    <button id="deleteBuildingBtn">Delete Building</button>
    <button id="closeBuildingPopupBtn">Close</button>
  </div>
</div>

<!-- Earnings Popup -->
<div id="earningsPopup" class="popupOverlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="earningsTitle">
  <div class="popupContent">
    <h2 id="earningsTitle">Your Income Sources</h2>
    <ul id="earningsList"></ul>
    <button id="closeEarningsBtn">Close</button>
  </div>
</div>

<!-- Offline Earnings Popup -->
<div id="offlineEarningsPopup" class="popupOverlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="offlineEarningsTitle">
  <div class="popupContent" style="text-align:center;">
    <h2 id="offlineEarningsTitle">Offline Earnings</h2>
    <p id="offlineEarningsAmount"></p>
    <button id="collectOfflineEarningsBtn">Collect</button>
  </div>
</div>

<script>
  // Data and state
  const gridSize = 16;
  const buildingsData = [
    { name: "House", emoji: "üè†", cost: 100, income: [5,10,20], population: [3,5,8] },
    { name: "Supermarket", emoji: "üõí", cost: 200, income: [20,30,50] },
    { name: "Power Plant", emoji: "‚ö°", cost: 300, income: [15,30,50] },
    { name: "Water Tower", emoji: "üíß", cost: 250, income: [10,25,40] },
    { name: "Factory", emoji: "üè≠", cost: 400, income: [25,40,60] },
    { name: "Bank", emoji: "üè¶", cost: 500, income: [50,80,120] },
    { name: "School", emoji: "üöå", cost: 300, income: [30,50,70] },
    { name: "Airport", emoji: "üõ©Ô∏è", cost: 1000, income: [100,150,200] },
    { name: "Hospital", emoji: "üöë", cost: 250, income: [10,20,30] },
    { name: "Subway", emoji: "üöá", cost: 250, income: [15,30,50] },
    { name: "Fire Station", emoji: "üöí", cost: 250, income: [20,30,50] },
    { name: "Music Store", emoji: "üè§", cost: 300, income: [35,50,70] },
    { name: "Apartment", emoji: "üè¢", cost: 1000, income: [60,90,130] },
    { name: "Amusement Park", emoji: "üé¢", cost: 1000, income: [100,140,190] },
    { name: "Gas Station", emoji: "‚õΩÔ∏è", cost: 150, income: [10,20,35] },
    { name: "Mall", emoji: "üè¨", cost: 800, income: [70,100,140] },
    { name: "Office", emoji: "üè¢", cost: 700, income: [60,90,120] },
    { name: "Bar", emoji: "üç∫", cost: 250, income: [30,45,65] },
    { name: "Gym", emoji: "üèãÔ∏è", cost: 300, income: [35,55,80] },
    { name: "Park", emoji: "üå≥", cost: 150, income: [15,25,40] },
  ];

  let cityGrid = new Array(gridSize * gridSize).fill(null);
  let money = 1000;
  let population = 0;
  let paycheckTimer = 60;
  let deleteMode = false;
  let selectedBuilding = "";
  let buildingPopupIndex = null;
  let lastTileClick = 0;

  // DOM Elements
  const homeScreen = document.getElementById("homeScreen");
  const gameScreen = document.getElementById("gameScreen");
  const howToPlayScreen = document.getElementById("howToPlayScreen");
  const moneySpan = document.getElementById("money");
  const populationSpan = document.getElementById("population");
  const paycheckSpan = document.getElementById("paycheckTimer");
  const backToHomeBtn = document.getElementById("backToHomeBtn");
  const startGameBtn = document.getElementById("startGameBtn");
  const howToPlayBtn = document.getElementById("howToPlayBtn");
  const backToHomeFromHowTo = document.getElementById("backToHomeFromHowTo");
  const buildingSelect = document.getElementById("buildingSelect");
  const deleteBtn = document.getElementById("deleteBtn");
  const earningsBtn = document.getElementById("earningsBtn");
  const gridDiv = document.getElementById("grid");

  const buildingPopup = document.getElementById("buildingPopup");
  const popupBuildingName = document.getElementById("popupBuildingName");
  const popupBuildingInfo = document.getElementById("popupBuildingInfo");
  const upgradeBuildingBtn = document.getElementById("upgradeBuildingBtn");
  const deleteBuildingBtn = document.getElementById("deleteBuildingBtn");
  const closeBuildingPopupBtn = document.getElementById("closeBuildingPopupBtn");

  const earningsPopup = document.getElementById("earningsPopup");
  const earningsList = document.getElementById("earningsList");
  const closeEarningsBtn = document.getElementById("closeEarningsBtn");

  const offlineEarningsPopup = document.getElementById("offlineEarningsPopup");
  const offlineEarningsAmount = document.getElementById("offlineEarningsAmount");
  const collectOfflineEarningsBtn = document.getElementById("collectOfflineEarningsBtn");

  const STORAGE_KEY = "citybuilder2_save";
  const LAST_ONLINE_TIME_KEY = "citybuilder2_lastOnline";

  // Utility Functions
  function indexToCoord(idx){
    return { x: idx % gridSize, y: Math.floor(idx / gridSize) };
  }
  function distance(a,b){
    return Math.abs(a.x - b.x) + Math.abs(a.y - b.y);
  }

  // Save and load game data
  function saveGame(){
    const data = {
      money, population, paycheckTimer, deleteMode, selectedBuilding,
      cityGrid
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    saveLastOnlineTime();
  }
  function loadGame(){
    const dataStr = localStorage.getItem(STORAGE_KEY);
    if(!dataStr) return false;
    try{
      const data = JSON.parse(dataStr);
      if(data.money !== undefined) money = data.money;
      if(data.population !== undefined) population = data.population;
      if(data.paycheckTimer !== undefined) paycheckTimer = data.paycheckTimer;
      if(data.deleteMode !== undefined) deleteMode = data.deleteMode;
      if(data.selectedBuilding !== undefined) selectedBuilding = data.selectedBuilding;
      if(data.cityGrid !== undefined && data.cityGrid.length === gridSize*gridSize) {
        cityGrid = data.cityGrid;
      }
      return true;
    }catch(e){
      console.warn("Failed loading save:", e);
      return false;
    }
  }

  // Populate building dropdown
  function populateBuildingSelect(){
    buildingSelect.innerHTML = '<option value="">-- Select Building --</option>';
    buildingsData.forEach((b,i) => {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = `${b.name} ${b.emoji} ($${b.cost})`;
      buildingSelect.appendChild(option);
    });
  }

  // Update UI info displays
  function updateUI(){
    moneySpan.textContent = money.toFixed(0);
    populationSpan.textContent = population;
    paycheckSpan.textContent = paycheckTimer;
    deleteBtn.textContent = deleteMode ? "Delete Mode: On" : "Delete Mode: Off";
    deleteBtn.setAttribute("aria-pressed", deleteMode);
    buildingSelect.value = selectedBuilding;
    renderGrid();
  }

  // Render grid tiles
  function renderGrid(){
    gridDiv.innerHTML = "";
    cityGrid.forEach((tile, idx) => {
      const tileDiv = document.createElement("div");
      tileDiv.className = "tile";
      tileDiv.dataset.index = idx;
      if(tile){
        const bData = buildingsData[tile.buildingIndex];
        tileDiv.textContent = bData.emoji + (tile.level > 1 ? tile.level : "");
        tileDiv.title = `${bData.name} (Level ${tile.level})`;
      } else {
        tileDiv.textContent = "";
        tileDiv.title = "";
      }
      tileDiv.addEventListener("click", () => {
        const now = Date.now();
        if(now - lastTileClick < 200) return; // debounce
        lastTileClick = now;

        if(deleteMode && cityGrid[idx]){
          deleteBuildingAt(idx);
        } else if(cityGrid[idx]){
          openBuildingPopup(idx);
        } else if(!deleteMode && selectedBuilding !== ""){
          placeBuilding(idx);
        }
      });
      tileDiv.addEventListener("keydown", e => {
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          tileDiv.click();
        }
      });
      gridDiv.appendChild(tileDiv);
    });
  }

  // Place building
  function placeBuilding(idx){
    if(cityGrid[idx]) return; // occupied
    const bIndex = parseInt(selectedBuilding);
    if(isNaN(bIndex)) return;
    const bData = buildingsData[bIndex];
    if(money < bData.cost){
      alert("Not enough money!");
      return;
    }
    money -= bData.cost;
    cityGrid[idx] = { buildingIndex: bIndex, level: 1 };
    updatePopulation();
    saveGame();
    updateUI();
  }

  // Open building popup
  function openBuildingPopup(idx){
    buildingPopupIndex = idx;
    const tile = cityGrid[idx];
    if(!tile) return;
    const bData = buildingsData[tile.buildingIndex];

    popupBuildingName.textContent = `${bData.name} ${bData.emoji}`;
    let infoText = `Level: ${tile.level}\nCost: $${bData.cost}\nIncome: $${bData.income[tile.level-1]}/min`;
    if(bData.population){
      infoText += `\nPopulation: ${bData.population[tile.level-1]}`;
    }
    if(tile.level >= 3){
      infoText += `\n\nMax level reached`;
      upgradeBuildingBtn.disabled = true;
    } else {
      upgradeBuildingBtn.disabled = false;
      const nextCost = Math.round(bData.cost * (tile.level + 1) * 0.5);
      infoText += `\nUpgrade Cost: $${nextCost}`;
    }
    popupBuildingInfo.textContent = infoText;

    buildingPopup.style.display = "flex";
  }

  // Close building popup
  function closeBuildingPopup(){
    buildingPopup.style.display = "none";
    buildingPopupIndex = null;
  }

  // Upgrade building
  function upgradeBuilding(){
    if(buildingPopupIndex === null) return;
    const tile = cityGrid[buildingPopupIndex];
    if(!tile) return;
    const bData = buildingsData[tile.buildingIndex];
    if(tile.level >= 3) return;
    const nextCost = Math.round(bData.cost * (tile.level + 1) * 0.5);
    if(money < nextCost){
      alert("Not enough money!");
      return;
    }
    money -= nextCost;
    tile.level++;
    updatePopulation();
    saveGame();
    updateUI();
    openBuildingPopup(buildingPopupIndex);
  }

  // Delete building
  function deleteBuildingAt(idx){
    const tile = cityGrid[idx];
    if(!tile) return;
    const bData = buildingsData[tile.buildingIndex];
    let refund = bData.cost;
    for(let lvl = 2; lvl <= tile.level; lvl++){
      refund += Math.round(bData.cost * lvl * 0.5);
    }
    money += refund;
    cityGrid[idx] = null;
    updatePopulation();
    saveGame();
    updateUI();
    if(buildingPopupIndex === idx) closeBuildingPopup();
  }

  // Update population
  function updatePopulation(){
    population = 0;
    for(let idx=0; idx < cityGrid.length; idx++){
      const tile = cityGrid[idx];
      if(tile){
        const bData = buildingsData[tile.buildingIndex];
        if(bData.name === "House"){
          if(hasPowerAndWaterNearby(idx)){
            population += bData.population[tile.level-1];
          }
        }
      }
    }
  }

  // Check power and water nearby within 3 blocks
  function hasPowerAndWaterNearby(idx){
    const coord = indexToCoord(idx);
    let powerFound = false;
    let waterFound = false;
    for(let i=0; i < cityGrid.length; i++){
      if(cityGrid[i]){
        const bData = buildingsData[cityGrid[i].buildingIndex];
        if(distance(coord, indexToCoord(i)) <= 3){
          if(bData.name === "Power Plant") powerFound = true;
          if(bData.name === "Water Tower") waterFound = true;
        }
      }
      if(powerFound && waterFound) return true;
    }
    return false;
  }

  // Calculate total income per minute
  function calculateIncome(){
    let total = 0;
    cityGrid.forEach(tile => {
      if(tile){
        const bData = buildingsData[tile.buildingIndex];
        if(bData.income){
          total += bData.income[tile.level-1];
        }
      }
    });
    return total;
  }

  // Paycheck timer tick
  function paycheckTick(){
    paycheckTimer--;
    if(paycheckTimer <= 0){
      const income = calculateIncome();
      money += income;
      paycheckTimer = 60;
      updatePopulation();
      saveGame();
    }
    updateUI();
  }

  // Show earnings popup
  function showEarnings(){
    earningsList.innerHTML = "";
    const incomeMap = new Map();
    cityGrid.forEach(tile => {
      if(tile){
        const bData = buildingsData[tile.buildingIndex];
        if(!incomeMap.has(bData.name)){
          incomeMap.set(bData.name, {income: 0, count: 0});
        }
        incomeMap.get(bData.name).income += bData.income[tile.level-1];
        incomeMap.get(bData.name).count++;
      }
    });
    if(incomeMap.size === 0){
      const li = document.createElement("li");
      li.textContent = "No income generating buildings yet.";
      earningsList.appendChild(li);
    } else {
      incomeMap.forEach((val,key) => {
        const li = document.createElement("li");
        li.textContent = `${key} (${val.count}): $${val.income}/min`;
        earningsList.appendChild(li);
      });
    }
    earningsPopup.style.display = "flex";
  }

  // Close earnings popup
  closeEarningsBtn.addEventListener("click", () => {
    earningsPopup.style.display = "none";
  });

  // Close building popup
  closeBuildingPopupBtn.addEventListener("click", closeBuildingPopup);

  // Upgrade building button
  upgradeBuildingBtn.addEventListener("click", upgradeBuilding);

  // Delete building button
  deleteBuildingBtn.addEventListener("click", () => {
    if(buildingPopupIndex !== null) deleteBuildingAt(buildingPopupIndex);
    closeBuildingPopup();
  });

  // Toggle delete mode button
  deleteBtn.addEventListener("click", () => {
    deleteMode = !deleteMode;
    selectedBuilding = "";
    buildingSelect.value = "";
    updateUI();
  });

  // Building select dropdown
  buildingSelect.addEventListener("change", e => {
    selectedBuilding = e.target.value;
    if(selectedBuilding !== "") deleteMode = false;
    updateUI();
  });

  // Back to home button
  backToHomeBtn.addEventListener("click", () => {
    saveLastOnlineTime();
    gameScreen.style.display = "none";
    homeScreen.style.display = "block";
    buildingPopup.style.display = "none";
    earningsPopup.style.display = "none";
  });

  // Start game button
  startGameBtn.addEventListener("click", () => {
    homeScreen.style.display = "none";
    handleOfflineEarnings();
    gameScreen.style.display = "block";
  });

  // How to play button
  howToPlayBtn.addEventListener("click", () => {
    homeScreen.style.display = "none";
    howToPlayScreen.style.display = "block";
  });

  // Back from how to play screen
  backToHomeFromHowTo.addEventListener("click", () => {
    howToPlayScreen.style.display = "none";
    homeScreen.style.display = "block";
  });

  // Show earnings popup on button click
  earningsBtn.addEventListener("click", showEarnings);

  // Offline earnings popup collect button
  collectOfflineEarningsBtn.addEventListener("click", () => {
    const amount = parseInt(offlineEarningsAmount.dataset.amount) || 0;
    money += amount;
    offlineEarningsPopup.style.display = "none";
    saveGame();
    updateUI();
  });

  // Offline earnings popup close on outside click
  offlineEarningsPopup.addEventListener("click", e => {
    if(e.target === offlineEarningsPopup){
      offlineEarningsPopup.style.display = "none";
    }
  });

  // Grid keyboard navigation support
  gridDiv.addEventListener("keydown", e => {
    if(e.key === "Escape"){
      if(buildingPopup.style.display === "flex") closeBuildingPopup();
      if(earningsPopup.style.display === "flex") earningsPopup.style.display = "none";
      if(offlineEarningsPopup.style.display === "flex") offlineEarningsPopup.style.display = "none";
    }
  });

  // Save last online time for offline earnings
  function saveLastOnlineTime(){
    localStorage.setItem(LAST_ONLINE_TIME_KEY, Date.now().toString());
  }
  function getLastOnlineTime(){
    const t = localStorage.getItem(LAST_ONLINE_TIME_KEY);
    return t ? parseInt(t) : null;
  }

  // Handle offline earnings on game start
  function handleOfflineEarnings(){
    const lastTime = getLastOnlineTime();
    if(!lastTime) return;
    const now = Date.now();
    const diffMs = now - lastTime;
    if(diffMs < 60000) return; // less than 1 min no offline earnings
    const offlineMinutes = Math.floor(diffMs / 60000);
    const incomePerMin = calculateIncome();
    if(incomePerMin <= 0) return;

    const offlineEarned = Math.floor(incomePerMin * offlineMinutes * 0.1);
    if(offlineEarned <= 0) return;

    offlineEarningsAmount.textContent = `You earned $${offlineEarned} offline for ${offlineMinutes} minute(s).`;
    offlineEarningsAmount.dataset.amount = offlineEarned;
    offlineEarningsPopup.style.display = "flex";
  }

  // Initialize grid
  function initGrid(){
    cityGrid = new Array(gridSize * gridSize).fill(null);
  }

  // Start paycheck interval
  setInterval(paycheckTick, 1000);

  // Load or init game
  if(!loadGame()){
    initGrid();
  }
  updatePopulation();
  populateBuildingSelect();
  updateUI();

  // Save game every 15 seconds to be safe
  setInterval(saveGame, 15000);
</script>

</body>
</html>
